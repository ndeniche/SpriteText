window.SpriteTextCharacter=function(t,e){return{__image:null,__sx:0,__sy:0,__sWidth:0,__sHeight:0,__dx:0,__dy:0,__dWidth:0,__dHeight:0,__type:"char",init:function(t){return t.hasOwnProperty("image")&&t.hasOwnProperty("sx")&&t.hasOwnProperty("sy")&&t.hasOwnProperty("sWidth")&&t.hasOwnProperty("sHeight")?(this.__image=t.image,this.__sx=t.sx,this.__sy=t.sy,this.__sWidth=t.sWidth,this.__sHeight=t.sHeight,this.__dWidth=this.__sWidth*e,this.__dHeight=this.__sHeight*e,this):null},getWidth:function(){return this.__dWidth},getSourceWidth:function(){return this.__sWidth},drawImage:function(t,e){},getType:function(){return this.__type},getProperties(){return{image:this.__image,sx:this.__sx,sy:this.__sy,sWidth:this.__sWidth,sHeight:this.__sHeight,dx:this.__dx,dy:this.__dy,dWidth:this.__dWidth,dHeight:this.__dHeight}}}.init(t)},window.SpriteTextSpace=function(){return{__type:"space",init:function(t){return this},drawImage:function(t,e){},getType:function(){return this.__type}}.init()},window.SpriteText=function(t,e){return{__text:"",__spritesheets:[],__backgroundImage:null,__dimensions:[],__canvas:null,__settings:{},__properties:{},__iterate:!1,__defaults__:{whitespaceWidth:.5,caseSensitive:!1,verticalAlignment:"middle",horizontalAlignment:"center",initialPosition:[.5,.5],fontSize:80,rotation:0,rotateBoth:!0},__elements__:[],__that:null,get:function(){return this},init:function(t,e){return __that=this,this.setCanvas(t),void 0!==e&&(e.hasOwnProperty("text")&&this.setText(e.text),e.hasOwnProperty("spritesheets")&&this.setSpriteSheets(e.spritesheets),e.hasOwnProperty("dimensions")&&this.setDimensions(e.dimensions),e.hasOwnProperty("backgroundImage")&&this.setBackgroundImage(e.backgroundImage)),this.initSettings(e.hasOwnProperty("properties")?e.properties:null),this.checkLoadedImages(),this},getText:function(){return this.__text},setText:function(t){"string"==typeof t?(this.getSetting("caseSensitive")||(t=t.toLowerCase()),this.__text=t):(console.log("Text input must be a string"),this.text="")},getSpriteSheets:function(){return this.__spritesheets},setSpriteSheets:function(t){if(t instanceof Array){for(let e=0;e<t.length;e++)if("string"==typeof t[e]){let i=t[e];t[e]=new Image,t[e].loaded=!1,t[e].onload=function(){this.loaded=!0},t[e].src=i}else if("Image"!=typeof t[e])return console.log("All elements in the image array must be typeof Image"),void(this.__images=[]);this.__spritesheets=t}},getBackgroundImage:function(){return this.__backgroundImage},setBackgroundImage:function(t){if(t instanceof Image)this.__backgroundImage=t;else if("string"==typeof t){let e=new Image;e.loaded=!1,e.onload=function(){this.loaded=!0,__that.__backgroundImage=this},e.src=t,this.__backgroundImage=e}},getDimensions:function(){return this.__dimensions},setDimensions:function(t){let e=this.getSpriteSheets().length;if(t instanceof Array){if(t.length!=e&&1!=t.length)return console.error("When setting up multiple spritesheets with different dimensions, the amount of spritesheets and dimensions must match."),void(this.__dimensions=[]);this.__iterate=t.length==e;for(let i=0;i<e;i++)this.__dimensions.push(t[this.__iterate?i:0])}else if(t instanceof Object&&1==e)for(let i=0;i<e;i++)this.__dimensions.push(t[0])},getCanvas:function(){return this.__canvas},setCanvas:function(t){void 0!==t&&("string"==typeof t?this.setCanvas(document.getElementById(t)):t instanceof HTMLCanvasElement?this.__canvas=t:console.log("Canvas node must be of type canvas."))},initSettings:function(t){if(this.setDefaults(),null!=t)for(let e in t)this.setSetting(e,t[e]);this.setSetting("maxHeight",this.getMaxHeight()),this.setSetting("fontCount",this.getSpriteSheets().length)},setDefaults:function(){this.__settings=this.__defaults__},getSetting:function(t){return this.__settings[t]},setSetting:function(t,e){this.__settings[t]=e},getRatio:function(){return this.getSetting("fontSize")/this.getMaxHeight()},getMaxHeight:function(){let t=0,e=this.__iterate?this.getDimensions():[this.getDimensions()[0]];for(d in e)for(i in e[d]){let s=e[d][i][3]-e[d][i][2];t<s&&(t=s)}return t},getMaxWidth:function(){let t=0,e=this.__iterate?this.getDimensions():[this.getDimensions()[0]];for(d in e)for(i in e[d]){let s=e[d][i][1]-e[d][i][0];t<s&&(t=s)}return t},getLetter:function(t){let e=Math.floor(Math.random()*this.getSetting("fontCount")),i={},s=this.getDimensions()[e][t];return i.image=this.getSpriteSheets()[e],i.sx=s[0],i.sy=s[2],i.sWidth=s[1],i.sHeight=s[3],i},getSpace:function(){return this.getTotalHeight()*this.getSetting("whitespaceWidth")},clearElements:function(){this.__elements__=[]},addElement:function(t){this.__elements__.push(t)},getElements:function(){return this.__elements__},checkLoadedImages:function(){let t=__that.getSpriteSheets(),e=__that.getBackgroundImage();e=null==e||e.loaded;let i=!0;for(let s in t)t[s].loaded&&e||(i=!1);if(i)return __that.createTextElements(),void __that.drawElements();setTimeout(__that.checkLoadedImages,1e3)},reload:function(t){let e=this.getCanvas();e.getContext("2d").clearRect(0,0,e.width,e.height),this.setText(t),this.createTextElements(),this.drawElements()},createTextElements:function(){this.clearElements();let t=this.getText().split("");for(let e in t)if(" "==t[e])this.addElement(new SpriteTextSpace);else{let i=this.getLetter(t[e]);this.addElement(new SpriteTextCharacter(i,this.getRatio()))}},drawElements:function(){let t=this.getBackgroundImage(),e=this.getCanvas(),i=e.width/t.width;e.height=t.height*i;let s=this.getCanvasInitialPosition(),n=this.getSetting("horizontalAlignment"),h=this.getSetting("verticalAlignment"),a=this.getTotalWidth(),r=this.getTotalHeight(),o="center"==n?a/2:"right"==n?a:0,g=s.y-r/2,_=s.x-o;currPos=_,hasRotation=0!=this.getSetting("rotation"),el=this.getElements(),ctx=e.getContext("2d"),ctx.drawImage(t,0,0,e.width,e.height);for(let t in el)switch(el[t].getType()){case"char":{let e=el[t].getProperties(),i=r-e.dHeight;if(dx=currPos,dy=g+("middle"==h?i/2:"bottom"==h?i:0),hasRotation){let t=this.getRotationAngle();ctx.translate(dx+e.dWidth/2,dy+e.dHeight/2),ctx.rotate(t),ctx.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,-e.dWidth/2,-e.dHeight/2,e.dWidth,e.dHeight),ctx.rotate(-t),ctx.translate(-1*(dx+e.dWidth/2),-1*(dy+e.dHeight/2))}else ctx.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,dx,dy,e.dWidth,e.dHeight);currPos+=e.dWidth;break}case"space":currPos+=this.getSpace()}},getRotationAngle:function(){let t=this.getSetting("rotateBoth"),e=Math.random()*this.getSetting("rotation");return(e*=t&&Math.random()<.5?-1:1)*Math.PI/180},getTotalWidth:function(){let t=0,e=this.getElements(),i=this.getSpace();for(let s in e)switch(e[s].getType()){case"char":t+=e[s].getWidth();break;case"space":t+=i}return t},getFullWidth:function(){let t=0,e=this.getElements(),i=this.getMaxHeight()*this.getSetting("whitespaceWidth");for(let s in e)switch(e[s].getType()){case"char":t+=e[s].getSourceWidth();break;case"space":t+=i}return t},getTotalHeight:function(){return this.getMaxHeight()*this.getRatio()},getCanvasWidth:function(){return this.__canvas.width},getCanvasHeight:function(){return this.__canvas.height},getCanvasInitialPosition:function(){let t=this.getSetting("initialPosition");return{x:this.getCanvasWidth()*t[0],y:this.getCanvasHeight()*t[1]}}}.init(t,e)};