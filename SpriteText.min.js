window.SpriteTextCharacter=function(t,e){return{__image:null,__sx:0,__sy:0,__sWidth:0,__sHeight:0,__dx:0,__dy:0,__dWidth:0,__dHeight:0,__type:"char",init:function(t){return t.hasOwnProperty("image")&&t.hasOwnProperty("sx")&&t.hasOwnProperty("sy")&&t.hasOwnProperty("sWidth")&&t.hasOwnProperty("sHeight")?(this.__image=t.image,this.__sx=t.sx,this.__sy=t.sy,this.__sWidth=t.sWidth,this.__sHeight=t.sHeight,this.__dWidth=this.__sWidth*e,this.__dHeight=this.__sHeight*e,this):null},getWidth:function(){return this.__dWidth},getSourceWidth:function(){return this.__sWidth},drawImage:function(t,e){},getType:function(){return this.__type},getProperties(){return{image:this.__image,sx:this.__sx,sy:this.__sy,sWidth:this.__sWidth,sHeight:this.__sHeight,dx:this.__dx,dy:this.__dy,dWidth:this.__dWidth,dHeight:this.__dHeight}}}.init(t)},window.SpriteTextSpace=function(){return{__type:"space",init:function(t){return this},drawImage:function(t,e){},getType:function(){return this.__type}}.init()},window.SpriteText=function(t,e){return{__text:"",__spritesheets:[],__backgroundImage:null,__dimensions:[],__canvas:null,__settings:{},__properties:{},__iterate:!1,__inputText:null,__defaults__:{whitespaceWidth:.5,caseSensitive:!1,verticalAlignment:"middle",horizontalAlignment:"center",initialPosition:[.5,.5],fontSize:80,rotation:0,rotateBoth:!0,letterSeparation:.1},__elements__:[],__that:null,__functionBefore:null,__callback:null,get:function(){return this},init:function(t,e){return __that=this,this.setCanvas(t),void 0!==e&&(e.hasOwnProperty("text")&&this.setText(e.text),e.hasOwnProperty("spritesheets")&&this.setSpriteSheets(e.spritesheets),e.hasOwnProperty("dimensions")&&this.setDimensions(e.dimensions),e.hasOwnProperty("backgroundImage")&&this.setBackgroundImage(e.backgroundImage),e.hasOwnProperty("input")&&this.setInput(e.input)),this.initSettings(e.hasOwnProperty("properties")?e.properties:null),this.checkLoadedImages(),this},getText:function(){return this.__text},setText:function(t){"string"==typeof t?(this.getSetting("caseSensitive")||(t=t.toLowerCase()),this.__text=t):(console.log("Text input must be a string"),this.text="")},getSpriteSheets:function(){return this.__spritesheets},setSpriteSheets:function(t){if(t instanceof Array){for(let e=0;e<t.length;e++)if("string"==typeof t[e]){let i=t[e];t[e]=new Image,t[e].loaded=!1,t[e].onload=function(){this.loaded=!0},t[e].src=i}else if("Image"!=typeof t[e])return console.log("All elements in the image array must be typeof Image"),void(this.__images=[]);this.__spritesheets=t}},getBackgroundImage:function(){return this.__backgroundImage},setBackgroundImage:function(t){if(t instanceof Image)this.__backgroundImage=t;else if("string"==typeof t){let e=new Image;e.loaded=!1,e.onload=function(){this.loaded=!0,__that.__backgroundImage=this},e.src=t,this.__backgroundImage=e}},getDimensions:function(){return this.__dimensions},setDimensions:function(t){let e=this.getSpriteSheets().length;if(t instanceof Array){if(t.length!=e&&1!=t.length)return console.error("When setting up multiple spritesheets with different dimensions, the amount of spritesheets and dimensions must match."),void(this.__dimensions=[]);this.__iterate=t.length==e;for(let i=0;i<e;i++)this.__dimensions.push(t[this.__iterate?i:0])}else if(t instanceof Object&&1==e)for(let i=0;i<e;i++)this.__dimensions.push(t[0])},getCanvas:function(){return this.__canvas},setCanvas:function(t){void 0!==t&&("string"==typeof t?this.setCanvas(document.getElementById(t)):t instanceof HTMLCanvasElement?(this.__canvas=t,t.style.cursor="pointer",t.onclick=function(){__that.reload()}):console.log("Canvas node must be of type canvas."))},initSettings:function(t){if(this.setDefaults(),null!=t)for(let e in t)this.setSetting(e,t[e]);this.setSetting("maxHeight",this.getMaxHeight()),this.setSetting("fontCount",this.getSpriteSheets().length)},setDefaults:function(){this.__settings=this.__defaults__},getSetting:function(t){return this.__settings[t]},setSetting:function(t,e){this.__settings[t]=e},setFunctionBeforeDraw:function(t){this.__functionBefore=t},setCallback:function(t){this.__callback=t},getRatio:function(){return this.getSetting("fontSize")/this.getMaxHeight()},getCanvasRatio:function(){let t=this.getBackgroundImage();return void 0===t||null==t?1:this.getCanvas().offsetWidth/t.width},getMaxHeight:function(){let t=0,e=this.__iterate?this.getDimensions():[this.getDimensions()[0]];for(d in e)for(i in e[d]){let n=e[d][i][3]-e[d][i][2];t<n&&(t=n)}return t},getMaxWidth:function(){let t=0,e=this.__iterate?this.getDimensions():[this.getDimensions()[0]];for(d in e)for(i in e[d]){let n=e[d][i][1]-e[d][i][0];t<n&&(t=n)}return t},getLetter:function(t){let e=Math.floor(Math.random()*this.getSetting("fontCount")),i={},n=this.getDimensions()[e][t];return i.image=this.getSpriteSheets()[e],i.sx=n[0],i.sy=n[2],i.sWidth=n[1],i.sHeight=n[3],i},getSpace:function(t){return void 0!==t&&null!=t||(t=1),this.getTotalHeight()*this.getSetting("whitespaceWidth")*t},getLetterSeparation:function(){let t=this.getSetting("letterSeparation");return this.getTotalHeight()*t*this.getCanvasRatio()},clearElements:function(){this.__elements__=[]},addElement:function(t){this.__elements__.push(t)},getElements:function(){return this.__elements__},checkLoadedImages:function(){let t=__that.getSpriteSheets(),e=__that.getBackgroundImage();e=null==e||e.loaded;let i=!0;for(let n in t)t[n].loaded&&e||(i=!1);if(i)return __that.createTextElements(),void __that.drawElements();setTimeout(__that.checkLoadedImages,1e3)},reload:function(t){void 0===t&&(t=null!=this.__inputText?this.__inputText.value:this.getText());let e=this.getCanvas();e.getContext("2d").clearRect(0,0,e.width,e.height),this.setText(t),this.createTextElements(),this.drawElements()},createTextElements:function(){this.clearElements();let t=this.getText().split("");for(let e in t)if(" "==t[e])this.addElement(new SpriteTextSpace);else{let i=this.getLetter(t[e]);this.addElement(new SpriteTextCharacter(i,this.getRatio()))}},getFunctionBeforeDraw:function(){return void 0!==this.__functionBefore&&null!=this.__functionBefore?this.__functionBefore:null},getCallback:function(){return void 0!==this.__callback&&null!=this.__callback?this.__callback:null},drawElements:function(){let t=this.getFunctionBeforeDraw(),e=this.getCallback();null!=t&&t();let i=this.getBackgroundImage(),n=this.getCanvas(),s=this.getCanvasRatio();n.height=i.height*s;let a=this.getCanvasInitialPosition(),o=this.getSetting("horizontalAlignment"),r=this.getSetting("verticalAlignment"),g=this.getTotalWidth(),_=this.getTotalHeight(),l="center"==o?g/2:"right"==o?g:0,u=a.y-_/2,c=a.x-l*s,d=this.getLetterSeparation(),f=c,m=0!=this.getSetting("rotation"),p=this.getElements(),x=n.getContext("2d");x.drawImage(i,0,0,n.width,n.height);for(let t in p)switch(p[t].getType()){case"char":{let e=p[t].getProperties(),i=_-e.dHeight;if(dx=f,dy=u+("middle"==r?i/2:"bottom"==r?i:0),w=e.dWidth*s,h=e.dHeight*s,m){let t=this.getRotationAngle();x.translate(dx+w/2+d/2,dy+h/2),x.rotate(t),x.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,-w/2,-h/2,w,h),x.rotate(-t),x.translate(-1*(dx+w/2+d/2),-1*(dy+h/2))}else x.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,dx+d/2,dy,w,h);f+=w+d;break}case"space":f+=this.getSpace(s)}null!=e&&e()},getRotationAngle:function(){let t=this.getSetting("rotateBoth"),e=Math.random()*this.getSetting("rotation");return(e*=t&&Math.random()<.5?-1:1)*Math.PI/180},getTotalWidth:function(){let t=0,e=this.getElements(),i=this.getSpace(),n=this.getLetterSeparation();for(let n in e)switch(e[n].getType()){case"char":t+=e[n].getWidth();break;case"space":t+=i}return t+=n*(e.length-1)},getFullWidth:function(){let t=0,e=this.getElements(),i=this.getMaxHeight()*this.getSetting("whitespaceWidth");for(let n in e)switch(e[n].getType()){case"char":t+=e[n].getSourceWidth();break;case"space":t+=i}return t+=this.getMaxHeight()*s*(e.length-1)},getTotalHeight:function(){return this.getMaxHeight()*this.getRatio()},getCanvasWidth:function(){return this.__canvas.width},getCanvasHeight:function(){return this.__canvas.height},getCanvasInitialPosition:function(){let t=this.getSetting("initialPosition");return{x:this.getCanvasWidth()*t[0],y:this.getCanvasHeight()*t[1]}},setInput:function(t){if("string"==typeof t){let e=document.getElementById(t);this.setInput(e)}else t instanceof HTMLInputElement?(this.__inputText=t,this.__inputText.onkeyup=function(){__that.reload()},this.setText(this.__inputText.value)):(Console.error("The input element must be type text."),this.__inputText=null)}}.init(t,e)};